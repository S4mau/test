<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Image-backed Quiz — Multi-type Demo (20 → 10/round)</title>
<style>
:root{
  --bg:#071021; --card:#0f1724; --muted:#c8d0df; --accent:#ffb703;
  --ok:#1e693f; --bad:#a32727;
}
*{box-sizing:border-box}
body{
  margin:0; min-height:100vh; font-family:Inter,system-ui,Arial;
  background:linear-gradient(180deg,#071021 0%,#1a1730 100%); color:var(--muted);
  display:flex; align-items:center; justify-content:center; padding:18px;
}
.wrap{ width:min(1100px,96vw); background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.12));
  border-radius:12px; padding:14px; box-shadow:0 12px 40px rgba(2,6,23,0.6); border:1px solid rgba(255,255,255,0.03);
}

/* header/viewer */
.header{ display:flex; justify-content:space-between; align-items:center; gap:12px; margin-bottom:12px }
.header h1{ font-size:1.05rem; margin:0; color:#fff }
.header .stats{ display:flex; gap:10px; align-items:center }
.stat{ background:rgba(255,255,255,0.03); padding:6px 10px; border-radius:8px; font-weight:800; color:#fff }

/* viewer */
.viewer{ display:flex; gap:10px; align-items:center; justify-content:center; margin-bottom:12px; flex-wrap:wrap }
.vbtn{ background:transparent; color:var(--muted); border:1px solid rgba(255,255,255,0.04); padding:8px 12px; border-radius:10px; cursor:pointer; font-weight:800 }
.imgWrap{ 

 width: 800px; 

max-width: 90vw; 

height: 500px; 

 overflow: auto; 
 background:#02030a; 
border-radius:10px; 
 display:flex; 
 align-items:flex-start; 
justify-content:flex-start;
 border: 1px solid var(--accent); 
}

.imgWrap img{ 
 max-width: none; 
 max-height: none; 
 width: 100%; 
 display:block 
}


@media (max-width:880px){ 
 .answers{ grid-template-columns:1fr } 
 .viewer{ 
 flex-direction: column; 
 }
 .imgWrap{ 
 width: 100%; 
height: 350px; 
 max-width: 100%;
 }
 .viewer-controls { 
 width: 100%; 
 justify-content: space-between; 
 }
}
.viewer-controls { display:flex; gap:8px; align-items:center; }

/* answers */
.answers{ display:grid; grid-template-columns:repeat(2,1fr); gap:12px }
@media (max-width:880px){ .answers{ grid-template-columns:1fr } }
.qcard{ background:var(--card); padding:12px; border-radius:10px; border:1px solid rgba(255,255,255,0.02); }
.qhead{ display:flex; justify-content:space-between; align-items:center; margin-bottom:8px; color:#eaf2ff; font-weight:800 }
.opts{ display:flex; gap:8px; flex-wrap:wrap }
.opt{ padding:8px 12px; border-radius:10px; background:rgba(255,255,255,0.03); border:1px solid rgba(255,255,255,0.02); cursor:pointer; min-width:48px; text-align:center; font-weight:900; color:var(--muted); transition:transform .12s }
.opt:hover{ transform:translateY(-4px) }
.opt.selected{ outline:3px solid rgba(255,183,3,0.14); background:rgba(255,183,3,0.12); color:#fff }
.opt.correct{ background:var(--ok); color:#fff; box-shadow:0 6px 18px rgba(30,105,63,0.16) }
.opt.wrong{ background:var(--bad); color:#fff; box-shadow:0 6px 18px rgba(163,39,39,0.16) }
.inputText { width:100%; padding:8px; border-radius:8px; border:1px solid rgba(255,255,255,0.04); background:rgba(255,255,255,0.02); color:var(--muted) }

/* footer controls */
.controls{ display:flex; justify-content:space-between; align-items:center; margin-top:12px; gap:8px }
.btnPrimary{ background:linear-gradient(90deg,#ffb703,#ff9800); color:#111; font-weight:900; border:none; padding:10px 14px; border-radius:10px; cursor:pointer }
.btnGhost{ background:transparent; color:var(--muted); border:1px solid rgba(255,255,255,0.04); padding:8px 12px; border-radius:10px; cursor:pointer }
.small{ font-size:0.92rem; color:#97a0b6 }
.center{ display:flex; gap:8px; align-items:center }
.finalBox{ text-align:center; padding:16px; background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.12)); border-radius:8px; margin-top:12px }
.note{ font-size:0.9rem; color:#a9b3c7 }
.badge{ background:rgba(255,255,255,0.02); padding:6px 10px; border-radius:8px }




.header-title {
  text-shadow: 1px 1px 2px rgba(0,0,0,0.4);
}

/* container for Menu + Fumo */
.header-right {
  display: flex;
  align-items: center;
  gap: 50px; /* space between Menu and Fumo */
}

/* Menu styling */
.menu-link {
  color: white;
  text-decoration: none;
  font-size: 0.9em;
  background: rgba(255,255,255,0.1);
  padding: 6px 12px;
  border-radius: 12px;
  transition: background 0.25s, transform 0.25s;
}

.menu-link:hover {
  background: rgba(255,255,255,0.25);
  transform: scale(1.05);
}


/* push page content below header */
body {
  margin-top: 70px;
}


header {
  /* existing styles… */
  box-shadow: 0 4px 8px rgba(0,0,0,0.25); /* current shadow */
}
header {
    position: fixed;
    top: 0; left: 0;
    width: 100%;
    /* NEW: Dark, moody, low-contrast gradient (Deep Red to Deep Purple) */
    background: linear-gradient(90deg, #4d0d0d, #330044); 
    
    color: white;
    padding: 15px 25px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 1.8em;
    font-weight: bold;
    /* Soften the shadow so it doesn't look like a bright light source */
    box-shadow: 0 4px 10px rgba(0,0,0,0.5);
    z-index: 9999;
}
</style>
</head>
<body>


<header>
  <div class="header-title"></div>
  
  <div class="header-right">
    <a href="index.html" class="menu-link">Menu</a>

  </div>
</header>



<div class="wrap">
  <div class="header">
    <h1>Image-backed Quiz — Mixed types (20 → 10/round)</h1>
    <div class="stats">
      <div class="stat">Round: <span id="roundIdx">1</span>/<span id="roundTotal">2</span></div>
      <div class="stat">Score: <span id="accScore">0</span> / <span id="poolTotal">20</span></div>
    </div>
  </div>


  <div class="viewer">
    <div class="viewer-controls">
      <button class="vbtn" id="prevBtn">◀ Prev</button>
    </div>
    <div class="imgWrap"><img id="viewerImg" src="assets/images/1.jpg" alt="q-img" onerror="this.style.filter='grayscale(1)';"></div>
    <div class="viewer-controls">
      <button class="vbtn" id="nextBtn">Next ▶</button>
    </div>
    <div style="width:12px"></div>
    <div class="small" id="viewerIndex">Image 1 / 20</div>
  </div>


  <section>
    <div style="display:flex; justify-content:space-between; gap:8px; align-items:center; margin-bottom:10px">
      <div>
        <div class="note">Use Prev/Next to read the question images. Each answer slot below corresponds to a question number (image).</div>
        <div class="note">Question types: <strong>MCQ</strong> = single A–D, <strong>Multi</strong> = choose up to N true options, <strong>Text</strong> = type answer.</div>
      </div>
      <div style="display:flex; gap:8px">
        <button class="btnGhost" id="retrySame">Retry Round</button>
        <button class="btnGhost" id="reshuffleAll">Reshuffle All</button>
      </div>
    </div>


    <div class="answers" id="answers"></div>


    <div class="controls">
      <div class="small">Answered: <span id="selectedCount">0</span> / <span id="perRound">10</span></div>
      <div class="center">
        <button class="btnGhost" id="confirmBtn" disabled>Confirm Answers</button>
        <button class="btnPrimary" id="nextBtnRound" style="display:none">Next Round ▶</button>
      </div>
    </div>


    <div id="finalBoxHolder"></div>
  </section>
</div>


<!-- optional audio -->
<audio id="sClick" src="assets/sounds/sfx_click.ogg" preload="auto"></audio>
<audio id="sCorrect" src="assets/sounds/Correct-1.ogg" preload="auto"></audio>
<audio id="sWrong" src="assets/sounds/Incorrect-1.ogg" preload="auto"></audio>

<script>
/* ---------------- CONFIG / DEMO POOL ----------------
 - images: assets/images/1.jpg ... 20.jpg
 - pool items: number, type: 'mcq'|'multi'|'text'
   mcq: correct = "A"|"B"|"C"|"D"
   multi: correct = ["A","C"], maxSelect = 3
   text: correct = "mitochondria" (string compare, case-insensitive, trimmed)
*/
const TOTAL_Q = 34;
const PER_ROUND = 10;

const POOL = [
  { number:1, type:'mcq', correct:'B' },
  { number:2, type:'multi', correct:['A','C'], maxSelect:3 },
  { number:3, type:'text', correct:'mitochondria' },
  { number:4, type:'mcq', correct:'D' },
  { number:5, type:'multi', correct:['B','C','D'], maxSelect:3 },
  { number:6, type:'mcq', correct:'A' },
  { number:7, type:'text', correct:'osmosis' },
  { number:8, type:'multi', correct:['A'], maxSelect:3 },
  { number:9, type:'mcq', correct:'C' },
  { number:10, type:'mcq', correct:'A' },
  { number:11, type:'text', correct:'glycolysis' },
  { number:12, type:'multi', correct:['B','D'], maxSelect:3 },
  { number:13, type:'mcq', correct:'C' },
  { number:14, type:'mcq', correct:'B' },
  { number:15, type:'text', correct:'homeostasis' },
  { number:16, type:'multi', correct:['A','B'], maxSelect:3 },
  { number:17, type:'mcq', correct:'D' },
  { number:18, type:'mcq', correct:'B' },
  { number:19, type:'text', correct:'chlorophyll' },
  { number:20, type:'multi', correct:['C','D'], maxSelect:3 },

  { number:21, type:'mcq', correct:'B' },
  { number:12515, type:'text', correct:'chlorophyll' },
  { number:22, type:'multi', correct:['C','D'], maxSelect:3 }
];

/* ---------------- state ---------------- */
let shuffled = [];
let batches = [];
let currentBatchIndex = 0;
let selections = {}; // map number -> selected (string for mcq/text, array for multi)
let revealed = false;
let accScore = 0;
let viewIndex = 1;

/* ---------------- DOM ---------------- */
const answersEl = document.getElementById('answers');
const viewerImg = document.getElementById('viewerImg');
const viewerIndex = document.getElementById('viewerIndex');
const prevBtn = document.getElementById('prevBtn');
const nextBtn = document.getElementById('nextBtn');
const selectedCountEl = document.getElementById('selectedCount');
const confirmBtn = document.getElementById('confirmBtn');
const nextBtnRound = document.getElementById('nextBtnRound');
const retrySameBtn = document.getElementById('retrySame');
const reshuffleAllBtn = document.getElementById('reshuffleAll');
const roundIdxEl = document.getElementById('roundIdx');
const roundTotalEl = document.getElementById('roundTotal');
const accScoreEl = document.getElementById('accScore');
const poolTotalEl = document.getElementById('poolTotal');
const perRoundEl = document.getElementById('perRound');
const finalBoxHolder = document.getElementById('finalBoxHolder');

const sClick = document.getElementById('sClick');
const sCorrect = document.getElementById('sCorrect');
const sWrong = document.getElementById('sWrong');

function play(el){ try{ el.currentTime=0; el.play(); }catch(e){} }
function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]] } return a; }

/* ---------------- init / batching ---------------- */
function prepare(){
  poolTotalEl.textContent = POOL.length;
  shuffled = shuffle([...POOL]);
  batches = [];
  for(let i=0;i<shuffled.length;i+=PER_ROUND) batches.push(shuffled.slice(i, i+PER_ROUND));
  roundTotalEl.textContent = batches.length;
  currentBatchIndex = 0;
  accScore = 0;
  accScoreEl.textContent = accScore;
}



/* ---------------- viewer ---------------- */
function updateViewer(){
viewerImg.src = `assets/M-images/${viewIndex}-M.jpg`;

  viewerIndex.textContent = `Image ${viewIndex} / ${TOTAL_Q}`;
}



function attachViewer(){
  prevBtn.addEventListener('click', ()=>{ viewIndex = Math.max(1, viewIndex-1); updateViewer(); });
  nextBtn.addEventListener('click', ()=>{ viewIndex = Math.min(TOTAL_Q, viewIndex+1); updateViewer(); });
  window.addEventListener('keydown', (e)=>{ if(e.key==='ArrowLeft'){ viewIndex=Math.max(1,viewIndex-1); updateViewer(); } if(e.key==='ArrowRight'){ viewIndex=Math.min(TOTAL_Q,viewIndex+1); updateViewer(); }});
}

/* ---------------- render batch ---------------- */
function renderBatch(){
  finalBoxHolder.innerHTML = '';
  revealed = false;
  selections = {};
  answersEl.innerHTML = '';
  const batch = batches[currentBatchIndex];
  roundIdxEl.textContent = currentBatchIndex+1;
  perRoundEl.textContent = batch.length;

  batch.forEach(item=>{
    const card = document.createElement('div');
    card.className = 'qcard';
    card.dataset.num = item.number;

    const typeLabel = item.type === 'mcq' ? 'MCQ' : item.type === 'multi' ? `Multi (max ${item.maxSelect})` : 'Text';
    card.innerHTML = `<div class="qhead"><div>Q${item.number}</div><div class="small">${typeLabel}</div></div>`;

    if(item.type === 'text'){
      const input = document.createElement('input');
      input.className = 'inputText';
      input.placeholder = 'Type answer...';
      input.addEventListener('input', ()=> {
        if(revealed) return;
        const val = input.value.trim();
        if(val.length>0) selections[item.number] = val;
        else delete selections[item.number];
        updateSelectionState();
      });
      card.appendChild(input);
    } else {
      const opts = document.createElement('div');
      opts.className = 'opts';
      ['A','B','C','D'].forEach(opt=>{
        const b = document.createElement('div');
        b.className = 'opt';
        b.textContent = opt;
        b.addEventListener('click', ()=>{
          if(revealed) return;
          if(item.type === 'mcq'){
            // single select
            Array.from(opts.children).forEach(ch=> ch.classList.remove('selected'));
            b.classList.add('selected');
            selections[item.number] = opt;
            play(sClick);
          } else if(item.type === 'multi'){
            // toggle, limit to maxSelect
            const already = b.classList.contains('selected');
            if(!already){
              // check current count
              const cur = (selections[item.number] || []);
              if(cur.length >= (item.maxSelect||3)) {
                // small feedback: flash quickly
                b.animate([{transform:'translateY(0)'},{transform:'translateY(-6px)'},{transform:'translateY(0)'}],{duration:220});
                return;
              }
              b.classList.add('selected');
              selections[item.number] = [...(selections[item.number] || []), opt];
            } else {
              b.classList.remove('selected');
              selections[item.number] = (selections[item.number] || []).filter(x=>x!==opt);
              if(selections[item.number].length===0) delete selections[item.number];
            }
            play(sClick);
          }
          updateSelectionState();
        });
        opts.appendChild(b);
      });
      card.appendChild(opts);
    }
    answersEl.appendChild(card);
  });

  updateSelectionState();
  nextBtnRound.style.display='none';
  confirmBtn.disabled = true;
}

/* ---------------- update state ---------------- */
function updateSelectionState(){
  const answered = Object.keys(selections).length;
  selectedCountEl.textContent = answered;
  const need = batches[currentBatchIndex].length;
  confirmBtn.disabled = (answered < need) || revealed;
}

/* ---------------- confirm/reveal logic ---------------- */
confirmBtn.addEventListener('click', ()=>{
  if(Object.keys(selections).length < batches[currentBatchIndex].length) return alert('Answer all slots before confirming.');
  revealed = true;
  let roundScore = 0;
  const batch = batches[currentBatchIndex];

  batch.forEach(item=>{
    const qnum = item.number;
    const card = answersEl.querySelector(`.qcard[data-num="${qnum}"]`);
    if(item.type === 'text'){
      const input = card.querySelector('.inputText');
      const answer = (selections[qnum]||'').toString().trim().toLowerCase();
      const correct = (item.correct||'').toString().trim().toLowerCase();
      input.disabled = true;
      if(answer === correct){
        input.style.borderColor = '#1e693f';
        input.style.boxShadow = '0 6px 18px rgba(30,105,63,0.12)';
        roundScore++;
        play(sCorrect);
      } else {
        input.style.borderColor = '#a32727';
        input.style.boxShadow = '0 6px 18px rgba(163,39,39,0.12)';
        play(sWrong);
      }
    } else if(item.type === 'mcq'){
      const chosen = selections[qnum];
      const opts = card.querySelectorAll('.opt');
      opts.forEach(optEl=>{
        const v = optEl.textContent;
        if(v === item.correct) optEl.classList.add('correct');
        if(v === chosen && v !== item.correct) optEl.classList.add('wrong');
        optEl.style.pointerEvents='none';
      });
      if(chosen === item.correct){
        roundScore++;
        play(sCorrect);
      } else {
        play(sWrong);
      }
    } else if(item.type === 'multi'){
      const chosen = selections[qnum] ? [...selections[qnum]] : [];
      // normalize sets
      const correctSet = (item.correct||[]).slice().sort();
      const chosenSet = chosen.slice().sort();
      const opts = card.querySelectorAll('.opt');
      opts.forEach(optEl=>{
        const v = optEl.textContent;
        const isChosen = chosen.includes(v);
        const isCorrect = item.correct.includes(v);
        if(isCorrect) optEl.classList.add('correct');
        if(isChosen && !isCorrect) optEl.classList.add('wrong');
        // disable clicks
        optEl.style.pointerEvents='none';
      });
      // award only if exact set match
      const eq = (a,b) => a.length===b.length && a.every((v,i)=>v===b[i]);
      if(eq(correctSet, chosenSet)){
        roundScore++;
        play(sCorrect);
      } else {
        play(sWrong);
      }
    }
  });

  accScore += roundScore;
  accScoreEl.textContent = accScore;

  if(currentBatchIndex < batches.length - 1){
    nextBtnRound.style.display='inline-block';
  } else {
    showFinal();
  }
  confirmBtn.disabled = true;
});

/* ---------------- next / retry / reshuffle ---------------- */
nextBtnRound.addEventListener('click', ()=>{
  currentBatchIndex++;
  renderBatch();
});
retrySameBtn.addEventListener('click', ()=> renderBatch());
reshuffleAllBtn.addEventListener('click', ()=>{
  prepare();
  renderBatch();
  viewIndex = 1; updateViewer();
});

/* ---------------- final summary ---------------- */
function showFinal(){
  finalBoxHolder.innerHTML = `<div class="finalBox">
    <h3>All rounds complete 🎉</h3>
    <p class="small">Total correct: <strong>${accScore}</strong> / ${POOL.length}</p>
    <div style="margin-top:10px; display:flex; gap:8px; justify-content:center">
      <button class="btnPrimary" id="restartSame">Restart (same order)</button>
      <button class="btnGhost" id="restartShuffle">Restart (reshuffle)</button>
    </div>
  </div>`;
  document.getElementById('restartSame').addEventListener('click', ()=>{
    currentBatchIndex = 0; accScore = 0; accScoreEl.textContent = accScore; renderBatch();
  });
  document.getElementById('restartShuffle').addEventListener('click', ()=>{
    prepare(); renderBatch();
  });
}

/* ---------------- boot ---------------- */
function boot(){
  prepare();
  attachViewer();
  renderBatch();
  updateViewer();
}
boot();
</script>
</body>
</html>
