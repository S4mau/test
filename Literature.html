<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Lively Quiz ‚Äì Normal Mode+</title>
<style>
  :root{ --radius:16px; --shadow:0 10px 30px rgba(0,0,0,.15); --speed:300ms; }
  *{box-sizing:border-box}
  body{ margin:0; min-height:100vh; display:flex; align-items:center; justify-content:center;
    font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    background: linear-gradient(135deg, #8EC5FC 0%, #E0C3FC 100%);}
  .wrap{ width:min(820px,94vw); background:#453C3C	; border-radius:24px; box-shadow:var(--shadow); padding:28px; }

  .top{ display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:12px; flex-wrap:wrap; }
  .badge{ background:#eef3ff; color:#2a4bd6; font-weight:700; padding:8px 12px; border-radius:999px; font-size:14px; }
  #scoreBadge{ background:#eafaf0; color:#1f7a3a; }

  .timerRow{ display:flex; align-items:center; gap:10px; margin:8px 0 20px }
  #timerText{ font-weight:700 }
  .bar{ flex:1; height:10px; background:#eee; border-radius:999px; overflow:hidden; box-shadow: inset 0 0 0 1px rgba(0,0,0,.04); }
  .fill{ height:100%; width:100%; background:#ffb703; transition:width linear; }

  .card{ background:#FFF0C4; padding:24px; border-radius:var(--radius); text-align:center; font-weight:800; font-size:22px; min-height:92px;
    display:flex; align-items:center; justify-content:center; box-shadow: inset 0 0 0 1px rgba(0,0,0,.05); }
  .fade-in{ animation:fadeIn .28s ease both } .fade-out{ animation:fadeOut .22s ease both }
  @keyframes fadeIn{ from{opacity:0; transform:translateY(6px)} to{opacity:1; transform:none} }
  @keyframes fadeOut{ from{opacity:1} to{opacity:0; transform:translateY(-6px)} }

  .answers{ margin-top:16px; display:grid; grid-template-columns:1fr; gap:12px }
  @media (min-width:640px){ .answers{ grid-template-columns:1fr 1fr } }
  .btn{ border:none; border-radius:14px; padding:16px; font-size:18px; font-weight:700; color:#fff; cursor:pointer; transition:transform var(--speed), filter var(--speed), box-shadow var(--speed); box-shadow:0 6px 18px rgba(0,0,0,.08); }
  .btn:hover{ transform:translateY(-2px) scale(1.02); filter:brightness(1.07) }
  .btn:disabled{ opacity:.85; cursor:default; transform:none; filter:none }

  .correct{ background:#18fdb8 !important; color:#fff !important; }
  .wrong{ background:#e65c39
 !important; color:#fff !important; animation:shake .22s linear 2 }
  @keyframes shake{ 0%,100%{transform:translateX(0)} 25%{transform:translateX(-6px)} 75%{transform:translateX(6px)} }
  .flash{ animation:flash 480ms ease both }
  @keyframes flash{ 0%{ box-shadow:0 0 0 0 rgba(40,167,69,.6) } 100%{ box-shadow:0 0 0 16px rgba(40,167,69,0) } }

  #board{ display:none; text-align:center; margin-top:10px;  color: white; }
  #board h2{ margin:8px 0 14px }
  .line{ opacity:0; transform:translateY(8px); transition:opacity .7s, transform .7s; font-size:18px; }
  .reveal{ opacity:1; transform:none }
  .actions{ margin-top:16px; display:flex; justify-content:center; gap:10px; flex-wrap:wrap }
  .ghost{ background:#2A1E29; color:#fff; border:none; border-radius:12px; padding:10px 16px; font-weight:800; cursor:pointer; transition:transform var(--speed), filter var(--speed); box-shadow:var(--shadow) }
  .ghost:hover{ transform:translateY(-1px) }

 .c1 { background: #b84f3e; } /* Muted Red-Orange from the ground/lava */
.c2 { background: #4e7a8e; } /* Desaturated Blue from the sky */
.c3 { background: #9c8a40; } /* Earthy Yellow-Green from the ground patterns */
.c4 { background: #5f3e5e; } /* Deep Muted Purple from the shadows */

  /* small stats row */
  .stats{ display:flex; gap:12px; flex-wrap:wrap; align-items:center; }
  .stat{ background:#f3f6ff; padding:8px 12px; border-radius:10px; font-weight:700; color:#213; }
  body {
  background-image: url('assets/Class.webp');
  background-size: cover;       /* fills the screen */
  background-position: center;  /* centers it */
  background-repeat: no-repeat; /* no tiling */
}



header {
  position: fixed;
  top: 0; left: 0;
  width: 100%;
  background: linear-gradient(90deg, #ff5f6d, #ffc371);
  color: white;
  padding: 15px 25px;
  display: flex;
  justify-content: space-between; /* title left, right container right */
  align-items: center;
  font-size: 1.8em;
  font-weight: bold;
  box-shadow: 0 4px 10px rgba(0,0,0,0.25);
  z-index: 9999;
}

.header-title {
  text-shadow: 1px 1px 2px rgba(0,0,0,0.4);
}

/* container for Menu + Fumo */
.header-right {
  display: flex;
  align-items: center;
  gap: 50px; /* space between Menu and Fumo */
}

/* Menu styling */
.menu-link {
  color: white;
  text-decoration: none;
  font-size: 0.9em;
  background: rgba(255,255,255,0.1);
  padding: 6px 12px;
  border-radius: 12px;
  transition: background 0.25s, transform 0.25s;
}

.menu-link:hover {
  background: rgba(255,255,255,0.25);
  transform: scale(1.05);
}

/* Fumo icon styling */
#fumoIcon {
    width: 48px;  /* bigger */
  height: 48px; /* bigger */
  cursor: pointer;
  transition: transform 0.15s;
}

/* squish effect on click */
#fumoIcon:active {
  transform: scaleX(1.3) scaleY(0.7);
}

/* push page content below header */
body {
  margin-top: 70px;
}


header {
  /* existing styles‚Ä¶ */
  box-shadow: 0 4px 8px rgba(0,0,0,0.25); /* current shadow */
}

header {
    position: fixed;
    top: 0; left: 0;
    width: 100%;
    height: var(--header-height); /* Explicit height */
    background: linear-gradient(90deg, #ff5f6d, #ffc371);
    color: white;
    padding: 15px 25px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 1.8em;
    font-weight: bold;
    box-shadow: 0 4px 8px rgba(0,0,0,0.25);
    z-index: 9999;
}
</style>



<header>
  <div class="header-title"></div>
  
  <div class="header-right">
    <a href="index.html" class="menu-link">Menu</a>

  </div>
</header>

</head>
<body>
  <div class="wrap" id="app">
    <div class="top">
      <div class="badge" id="qBadge">Question 1/1</div>
      <div class="stats">
        <div class="badge" id="scoreBadge">Score: <span id="score">0</span></div>
        <div class="stat">Correct: <span id="correctCount">0</span></div>
        <div class="stat">Wrong: <span id="wrongCount">0</span></div>
        <div class="stat">Time: <span id="elapsed">00:00</span></div>
      </div>
    </div>

    <div class="card fade-in" id="question">Loading‚Ä¶</div>

    <div class="answers" id="answers"></div>

    <div id="board">
      <h2>üéâ Final Score</h2>
      <div class="line" id="Lscore">Score: 0</div>
      <div class="line" id="Lcorrect">Correct: 0</div>
      <div class="line" id="Lwrong">Wrong: 0</div>
      <div class="line" id="Ltime">Total time: 00:00</div>
      <div class="line" id="Lavg">Avg / Q: 00:00</div>

      <div class="actions">
        <button class="ghost" id="retryShuffle">Retry (reshuffle)</button>
        <button class="ghost" id="retrySame">Retry (same order)</button>
      </div>
    </div>
  </div>

  <!-- audio hooks (point to your folder) -->
  <audio id="sClick" src="assets/sounds/sfx_click.ogg" preload="auto"></audio>
  <audio id="sCorrect" src="assets/sounds/Correct-1.ogg" preload="auto"></audio>
  <audio id="sWrong" src="assets/sounds/Incorrect-1.ogg" preload="auto"></audio>

<script>
/* ---------------- DATA ---------------- */
const QUESTIONS = [
   // Ph∆∞∆°ng th·ª©c bi·ªÉu ƒë·∫°t
  { q: "VƒÉn b·∫£n k·ªÉ l·∫°i chu·ªói s·ª± ki·ªán, nh√¢n v·∫≠t c√≥ t√¨nh hu·ªëng r√µ r√†ng. Ph∆∞∆°ng th·ª©c bi·ªÉu ƒë·∫°t ch·ªß y·∫øu l√†:", opts:["Mi√™u t·∫£","T·ª± s·ª±","Bi·ªÉu c·∫£m","Thuy·∫øt minh"], correct:"T·ª± s·ª±" },
  { q: "ƒêo·∫°n vƒÉn b√†y t·ªè c·∫£m x√∫c, t√¢m tr·∫°ng c·ªßa t√°c gi·∫£. Ph∆∞∆°ng th·ª©c bi·ªÉu ƒë·∫°t ch√≠nh l√†:", opts:["Ngh·ªã lu·∫≠n","Thuy·∫øt minh","Bi·ªÉu c·∫£m","T·ª± s·ª±"], correct:"Bi·ªÉu c·∫£m" },
  { q: "VƒÉn b·∫£n cung c·∫•p ki·∫øn th·ª©c v·ªÅ hi·ªán t∆∞·ª£ng thi√™n nhi√™n, gi·∫£i th√≠ch nguy√™n nh√¢n, c√°ch th·ª©c. Ph∆∞∆°ng th·ª©c bi·ªÉu ƒë·∫°t:", opts:["T·ª± s·ª±","Thuy·∫øt minh","Bi·ªÉu c·∫£m","Mi√™u t·∫£"], correct:"Thuy·∫øt minh" },
  { q: "ƒêo·∫°n vƒÉn tr√¨nh b√†y quan ƒëi·ªÉm, ph√¢n t√≠ch v·∫•n ƒë·ªÅ x√£ h·ªôi, nh·∫±m thuy·∫øt ph·ª•c ng∆∞·ªùi ƒë·ªçc. Ph∆∞∆°ng th·ª©c bi·ªÉu ƒë·∫°t:", opts:["Ngh·ªã lu·∫≠n","Mi√™u t·∫£","T·ª± s·ª±","Bi·ªÉu c·∫£m"], correct:"Ngh·ªã lu·∫≠n" },
  { q: "ƒêo·∫°n vƒÉn mi√™u t·∫£ c·∫£nh s√¥ng n√∫i v·ªõi chi ti·∫øt sinh ƒë·ªông, h√¨nh ·∫£nh tr·ª±c quan. Ph∆∞∆°ng th·ª©c bi·ªÉu ƒë·∫°t:", opts:["T·ª± s·ª±","Bi·ªÉu c·∫£m","Mi√™u t·∫£","Thuy·∫øt minh"], correct:"Mi√™u t·∫£" },
  { q: "VƒÉn b·∫£n k·ªÉ chuy·ªán k·∫øt h·ª£p mi√™u t·∫£ chi ti·∫øt nh√¢n v·∫≠t v√† c·∫£nh v·∫≠t, ph∆∞∆°ng th·ª©c ch·ªß ƒë·∫°o l√†:", opts:["Bi·ªÉu c·∫£m","T·ª± s·ª±","Mi√™u t·∫£","Thuy·∫øt minh"], correct:"T·ª± s·ª±" },
  { q: "ƒêo·∫°n vƒÉn th·ªÉ hi·ªán th√°i ƒë·ªô, c·∫£m x√∫c c·ªßa t√°c gi·∫£ tr∆∞·ªõc s·ª± vi·ªác. Ph∆∞∆°ng th·ª©c bi·ªÉu ƒë·∫°t l√†:", opts:["Bi·ªÉu c·∫£m","Thuy·∫øt minh","Ngh·ªã lu·∫≠n","T·ª± s·ª±"], correct:"Bi·ªÉu c·∫£m" },
  { q: "VƒÉn b·∫£n gi·∫£i th√≠ch v·ªÅ t√°c d·ª•ng c·ªßa √°nh s√°ng m·∫∑t tr·ªùi ƒë·ªëi v·ªõi c√¢y c·ªëi. Ph∆∞∆°ng th·ª©c bi·ªÉu ƒë·∫°t:", opts:["T·ª± s·ª±","Thuy·∫øt minh","Bi·ªÉu c·∫£m","Mi√™u t·∫£"], correct:"Thuy·∫øt minh" },
  { q: "VƒÉn b·∫£n ph√¢n t√≠ch, ƒë∆∞a l·∫≠p lu·∫≠n ƒë·ªÉ thuy·∫øt ph·ª•c ƒë·ªôc gi·∫£ v·ªÅ m·ªôt quan ƒëi·ªÉm x√£ h·ªôi. Ph∆∞∆°ng th·ª©c bi·ªÉu ƒë·∫°t:", opts:["Bi·ªÉu c·∫£m","Mi√™u t·∫£","Ngh·ªã lu·∫≠n","T·ª± s·ª±"], correct:"Ngh·ªã lu·∫≠n" },

  // Bi·ªán ph√°p tu t·ª´
  { q: "‚ÄúD√≤ng s√¥ng l·∫•p l√°nh nh∆∞ th·ªßy tinh‚Äù ‚Üí bi·ªán ph√°p:", opts:["·∫®n d·ª•","Nh√¢n h√≥a","So s√°nh","Ho√°n d·ª•"], correct:"So s√°nh" },
  { q: "‚ÄúGi√≥ h√°t, l√° reo, tr·ªùi m√¢y c≈©ng c∆∞·ªùi‚Äù ‚Üí bi·ªán ph√°p:", opts:["Nh√¢n h√≥a","N√≥i qu√°","ƒêi·ªáp ng·ªØ","Ch∆°i ch·ªØ"], correct:"Nh√¢n h√≥a" },
  { q: "‚ÄúV·ª´a ch·∫°y v·ª´a h√©t, v·ª´a kh√≥c v·ª´a c∆∞·ªùi‚Äù ‚Üí bi·ªán ph√°p:", opts:["Li·ªát k√™","N√≥i gi·∫£m n√≥i tr√°nh","C√¢u h·ªèi tu t·ª´","ƒê·∫£o ng·ªØ"], correct:"Li·ªát k√™" },
  { q: "‚Äú√Åo d√†i th∆∞·ªõt tha, t√≥c m√¢y bay bay, n·ª• c∆∞·ªùi nh∆∞ hoa‚Äù ‚Üí bi·ªán ph√°p:", opts:["So s√°nh","Li·ªát k√™","N√≥i qu√°","Ch∆°i ch·ªØ"], correct:"Li·ªát k√™" },
  { q: "‚ÄúTh·ªùi gian tr√¥i nhanh, ch·∫≥ng ch·ªù ai c·∫£‚Äù ‚Üí bi·ªán ph√°p:", opts:["Nh√¢n h√≥a","ƒê·∫£o ng·ªØ","Ho√°n d·ª•","C√¢u h·ªèi tu t·ª´"], correct:"Nh√¢n h√≥a" },
  { q: "‚ÄúAnh c√≥ th·ªÉ l√†m g√¨ kh√°c ngo√†i vi·ªác m·ªâm c∆∞·ªùi?‚Äù ‚Üí bi·ªán ph√°p:", opts:["C√¢u h·ªèi tu t·ª´","Li·ªát k√™","N√≥i gi·∫£m n√≥i tr√°nh","ƒê·∫£o ng·ªØ"], correct:"C√¢u h·ªèi tu t·ª´" },
  { q: "‚ÄúTr√°i tim r·ª±c ch√°y, ƒë√¥i m·∫Øt l·∫•p l√°nh, gi·ªçng n√≥i ·∫•m √°p‚Äù ‚Üí bi·ªán ph√°p:", opts:["Li·ªát k√™","Nh√¢n h√≥a","N√≥i qu√°","Ch∆°i ch·ªØ"], correct:"Li·ªát k√™" },
  { q: "‚ÄúKh√¥ng ph·∫£i c√°i ƒë·∫πp, m√† l√† c√°i di·ªÖm l·ªá‚Äù ‚Üí bi·ªán ph√°p:", opts:["Ph√©p ƒë·ªëi","Nh√¢n h√≥a","ƒêi·ªáp ng·ªØ","Ho√°n d·ª•"], correct:"Ph√©p ƒë·ªëi" },
  { q: "‚ÄúM√¢y tr·ªùi tr√¥i, m√¢y tr·ªùi l·∫°i bay‚Äù ‚Üí bi·ªán ph√°p:", opts:["ƒêi·ªáp c·∫•u tr√∫c c√¢u","Li·ªát k√™","ƒê·∫£o ng·ªØ","C√¢u h·ªèi tu t·ª´"], correct:"ƒêi·ªáp c·∫•u tr√∫c c√¢u" },
  { q: "‚ÄúTa ƒë√¢y l√† ai, sao l·∫°i l·∫°c v√†o ƒë√¢y?‚Äù ‚Üí bi·ªán ph√°p:", opts:["C√¢u h·ªèi tu t·ª´","Nh√¢n h√≥a","Li·ªát k√™","Ph√©p ƒë·ªëi"], correct:"C√¢u h·ªèi tu t·ª´" },

  // Th·ªÉ th∆°
  { q: "8 c√¢u, m·ªói c√¢u 7 ch·ªØ, tu√¢n lu·∫≠t b·∫±ng tr·∫Øc, v·∫ßn theo quy t·∫Øc ‚Üí th·ªÉ th∆°:", opts:["L·ª•c b√°t","Th·∫•t ng√¥n b√°t c√∫","Th·∫•t ng√¥n t·ª© tuy·ªát","Song th·∫•t l·ª•c b√°t"], correct:"Th·∫•t ng√¥n b√°t c√∫" },
  { q: "4 c√¢u, m·ªói c√¢u 7 ch·ªØ, v·∫ßn c√¢u 1,2,4 ‚Üí th·ªÉ:", opts:["Th·∫•t ng√¥n t·ª© tuy·ªát","Th·∫•t ng√¥n b√°t c√∫","L·ª•c b√°t","Th∆° nƒÉm ch·ªØ"], correct:"Th·∫•t ng√¥n t·ª© tuy·ªát" },
  { q: "2 c√¢u th·∫•t + 1 c√¢u l·ª•c + 1 c√¢u b√°t ‚Üí th·ªÉ:", opts:["Th·∫•t ng√¥n b√°t c√∫","L·ª•c b√°t","Song th·∫•t l·ª•c b√°t","Th∆° b·ªën ch·ªØ"], correct:"Song th·∫•t l·ª•c b√°t" },
  { q: "M·ªói c√¢u 6 ch·ªØ, ng·∫Øt nh·ªãp 2/2/2 ‚Üí th·ªÉ:", opts:["Th∆° s√°u ch·ªØ","Th∆° nƒÉm ch·ªØ","L·ª•c b√°t","Th·∫•t ng√¥n t·ª© tuy·ªát"], correct:"Th∆° s√°u ch·ªØ" },
  { q: "B√†i th∆° 5 ch·ªØ, v·∫ßn linh ho·∫°t, g·∫ßn g≈©i ‚Üí th·ªÉ:", opts:["Th∆° b·ªën ch·ªØ","Th∆° nƒÉm ch·ªØ","Th∆° s√°u ch·ªØ","L·ª•c b√°t"], correct:"Th∆° nƒÉm ch·ªØ" },
  { q: "4 ch·ªØ, nh·ªãp ng·∫Øn, th∆∞·ªùng d√πng d√¢n ca ‚Üí th·ªÉ:", opts:["Th∆° b·ªën ch·ªØ","Th∆° nƒÉm ch·ªØ","Th∆° s√°u ch·ªØ","L·ª•c b√°t"], correct:"Th∆° b·ªën ch·ªØ" },
  { q: "Th·ªÉ th∆° ƒë·∫∑c tr∆∞ng Vi·ªát Nam, c√¢u 6 n·ªëi c√¢u 8 ‚Üí th·ªÉ:", opts:["L·ª•c b√°t","Th·∫•t ng√¥n b√°t c√∫","Song th·∫•t l·ª•c b√°t","Th·∫•t ng√¥n t·ª© tuy·ªát"], correct:"L·ª•c b√°t" },
  { q: "Th∆° ƒê∆∞·ªùng lu·∫≠t, 8 c√¢u, 7 ch·ªØ m·ªói c√¢u, lu·∫≠t b·∫±ng tr·∫Øc ch·∫∑t ch·∫Ω ‚Üí th·ªÉ:", opts:["Th·∫•t ng√¥n b√°t c√∫","L·ª•c b√°t","Song th·∫•t l·ª•c b√°t","Th·∫•t ng√¥n t·ª© tuy·ªát"], correct:"Th·∫•t ng√¥n b√°t c√∫" },

  // Ng√¥i k·ªÉ
  { q: "C√¢u chuy·ªán k·ªÉ t·ª´ ‚Äút√¥i‚Äù, nh√¢n v·∫≠t ch√≠nh l√† ng∆∞·ªùi k·ªÉ ‚Üí ng√¥i k·ªÉ:", opts:["Ng√¥i th·ª© nh·∫•t","Ng√¥i th·ª© hai","Ng√¥i th·ª© ba","Ng√¥i kh√°ch quan"], correct:"Ng√¥i th·ª© nh·∫•t" },
  { q: "‚ÄúAnh ·∫•y‚Äù k·ªÉ, ng∆∞·ªùi k·ªÉ ƒë·ª©ng ngo√†i ‚Üí ng√¥i k·ªÉ:", opts:["Ng√¥i th·ª© nh·∫•t","Ng√¥i th·ª© hai","Ng√¥i th·ª© ba","Ng√¥i tr·ª±c ti·∫øp"], correct:"Ng√¥i th·ª© ba" },
  { q: "Ng∆∞·ªùi k·ªÉ tr·ª±c ti·∫øp ƒë·ªëi tho·∫°i v·ªõi ng∆∞·ªùi ƒë·ªçc ‚Üí ng√¥i k·ªÉ:", opts:["Ng√¥i th·ª© nh·∫•t","Ng√¥i th·ª© hai","Ng√¥i th·ª© ba","Ng√¥i kh√°ch quan"], correct:"Ng√¥i th·ª© hai" },
  { q: "C√¢u chuy·ªán k·ªÉ t·ª´ ng∆∞·ªùi ngo√†i, quan s√°t t·∫•t c·∫£ nh√¢n v·∫≠t ‚Üí ng√¥i k·ªÉ:", opts:["Ng√¥i th·ª© nh·∫•t","Ng√¥i th·ª© hai","Ng√¥i th·ª© ba","Ng√¥i tr·ª±c ti·∫øp"], correct:"Ng√¥i th·ª© ba" },
  { q: "Nh√¢n v·∫≠t k·ªÉ v·ªÅ ch√≠nh m√¨nh ‚Üí ng√¥i k·ªÉ:", opts:["Ng√¥i th·ª© nh·∫•t","Ng√¥i th·ª© hai","Ng√¥i th·ª© ba","Ng√¥i kh√°ch quan"], correct:"Ng√¥i th·ª© nh·∫•t" },
  { q: "Ng∆∞·ªùi k·ªÉ tr·ª±c ti·∫øp nh·∫Øc ƒë·∫øn ‚Äúb·∫°n‚Äù, ‚Äúc√°c b·∫°n‚Äù ‚Üí ng√¥i k·ªÉ:", opts:["Ng√¥i th·ª© nh·∫•t","Ng√¥i th·ª© hai","Ng√¥i th·ª© ba","Ng√¥i tr·ª±c ti·∫øp"], correct:"Ng√¥i th·ª© hai" },
  { q: "T√°c gi·∫£ k·ªÉ t·ª´ g√≥c nh√¨n to√†n tri ‚Üí ng√¥i k·ªÉ:", opts:["Ng√¥i th·ª© nh·∫•t","Ng√¥i th·ª© hai","Ng√¥i th·ª© ba","Ng√¥i tr·ª±c ti·∫øp"], correct:"Ng√¥i th·ª© ba" },
  { q: "Ng∆∞·ªùi k·ªÉ kh√¥ng tham gia c√¢u chuy·ªán, quan s√°t kh√°ch quan ‚Üí ng√¥i k·ªÉ:", opts:["Ng√¥i th·ª© nh·∫•t","Ng√¥i th·ª© hai","Ng√¥i th·ª© ba","Ng√¥i kh√°ch quan"], correct:"Ng√¥i th·ª© ba" }
];

/* ---------------- STATE ---------------- */
let order = [];
let qi = 0;
let score = 0;
let correctCount = 0;
let wrongCount = 0;
let startTime = null;
let questionStart = null;
let elapsedInterval = null;
let lastOrderSaved = []; // for "same order" retry

/* ---------------- DOM ---------------- */
const qBadge = document.getElementById('qBadge');
const scoreBadge = document.getElementById('score');
const correctBadge = document.getElementById('correctCount');
const wrongBadge = document.getElementById('wrongCount');
const questionEl = document.getElementById('question');
const answersEl = document.getElementById('answers');
const elapsedEl = document.getElementById('elapsed');
const board = document.getElementById('board');
const Lscore = document.getElementById('Lscore');
const Lcorrect = document.getElementById('Lcorrect');
const Lwrong = document.getElementById('Lwrong');
const Ltime = document.getElementById('Ltime');
const Lavg = document.getElementById('Lavg');
const retryShuffle = document.getElementById('retryShuffle');
const retrySame = document.getElementById('retrySame');

const sClick = document.getElementById('sClick');
const sCorrect = document.getElementById('sCorrect');
const sWrong = document.getElementById('sWrong');

/* ---------------- UTIL ---------------- */
function shuffle(arr){
  for(let i=arr.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]]=[arr[j],arr[i]];
  }
  return arr;
}
function formatTime(ms){
  const s = Math.floor(ms/1000);
  const mm = String(Math.floor(s/60)).padStart(2,'0');
  const ss = String(s%60).padStart(2,'0');
  return `${mm}:${ss}`;
}

/* ---------------- QUIZ FLOW ---------------- */
function start(reshuffle=true, preserveOrder=false){
  // reset stats
  score = 0; correctCount = 0; wrongCount = 0;
  qi = 0;

  // create order
  order = Array.from({length: QUESTIONS.length}, (_,i)=>i);
  if(reshuffle) shuffle(order);
  if(preserveOrder && lastOrderSaved.length===order.length) order = [...lastOrderSaved];
  lastOrderSaved = [...order];

  // timer
  startTime = Date.now();
  questionStart = Date.now();
  if(elapsedInterval) clearInterval(elapsedInterval);
  elapsedInterval = setInterval(()=> {
    elapsedEl.textContent = formatTime(Date.now()-startTime);
  }, 250);

  // UI
  board.style.display = 'none';
  questionEl.style.display = 'flex';
  answersEl.style.display = 'grid';
  updateBadges();
  renderQuestion();
}

function renderQuestion(){
  if(qi >= order.length){ return finish(); }

  // animate swap
  questionEl.classList.remove('fade-in'); questionEl.classList.add('fade-out');
  setTimeout(()=>{
    const q = QUESTIONS[order[qi]];
    questionEl.textContent = q.q;
    questionEl.classList.remove('fade-out'); questionEl.classList.add('fade-in');

    qBadge.textContent = `Question ${qi+1}/${order.length}`;

    answersEl.innerHTML = '';
    const opts = shuffle([...q.opts]); // randomize answer order
    const colorClasses = shuffle(['c1','c2','c3','c4']);
    opts.forEach((opt, idx)=>{
      const btn = document.createElement('button');
      btn.className = `btn ${colorClasses[idx]}`;
      btn.textContent = opt;
      btn.dataset.correct = (opt === q.correct) ? '1':'0';
      // play click sound on mousedown for snappy feel, but still evaluate on click
      btn.addEventListener('mousedown', ()=> { try { sClick.currentTime=0; sClick.play(); } catch(e){} });
      btn.addEventListener('click', ()=> choose(btn));
      answersEl.appendChild(btn);
    });

    // mark question start time
    questionStart = Date.now();
  }, 180);
}

function lockAnswers(){
  document.querySelectorAll('.btn').forEach(b=> b.disabled = true);
}

function choose(btn){
  if(btn.disabled) return;
  lockAnswers();

  const isCorrect = btn.dataset.correct === '1';

  // compute time per question if needed later
  const qTime = Date.now() - questionStart;

  if(isCorrect){
    btn.classList.add('correct','flash');
    score += 1;
    correctCount += 1;
    try { sCorrect.currentTime = 0; sCorrect.play(); } catch(e){}
    // highlight only chosen correct (no other wrong highlight needed)
    document.querySelectorAll('.btn').forEach(b => {
      if(b.dataset.correct === '1') b.classList.add('correct');
      b.disabled = true;
    });
  } else {
    wrongCount += 1;
    try { sWrong.currentTime = 0; sWrong.play(); } catch(e){}
    // mark ALL wrong answers red and the correct one green
    document.querySelectorAll('.btn').forEach(b=>{
      if(b.dataset.correct === '1'){
        b.classList.add('correct');
      }else{
        b.classList.add('wrong');
      }
      b.disabled = true;
    });
    // also add small red effect to the clicked button (it already gets wrong class)
  }

  updateBadges();
  // next question after a pause so user sees feedback
  setTimeout(()=> {
    qi++;
    renderQuestion();
  }, 950);
}

function finish(){
  clearInterval(elapsedInterval);
  const totalMs = Date.now() - startTime;
  questionEl.style.display = 'none';
  answersEl.style.display = 'none';
  board.style.display = 'block';

  // fill final stats
  Lscore.textContent = `Score: ${score} / ${QUESTIONS.length}`;
  Lcorrect.textContent = `Correct: ${correctCount}`;
  Lwrong.textContent = `Wrong: ${wrongCount}`;
  Ltime.textContent = `Total time: ${formatTime(totalMs)}`;
  const avgMs = totalMs / QUESTIONS.length;
  Lavg.textContent = `Avg / Q: ${formatTime(Math.round(avgMs))}`;

  // reveal animations (stagger)
  [Lscore,Lcorrect,Lwrong,Ltime,Lavg].forEach((el, i) => {
    setTimeout(()=> el.classList.add('reveal'), 80 * (i+1));
  });
  // show retry buttons enabled
  retryShuffle.disabled = false;
  retrySame.disabled = false;
}

function updateBadges(){
  document.getElementById('score').textContent = score;
  correctBadge.textContent = correctCount;
  wrongBadge.textContent = wrongCount;
}

/* ---------------- RESTART BUTTON HOOKS ---------------- */
retryShuffle.addEventListener('click', ()=> {
  retryShuffle.disabled = true; retrySame.disabled = true;
  start(true, false);
});
retrySame.addEventListener('click', ()=> {
  retryShuffle.disabled = true; retrySame.disabled = true;
  start(false, true);
});

/* ---------------- BOOT ---------------- */
start(true);




</script>
</body>
</html>
