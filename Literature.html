<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Lively Quiz â€“ Normal Mode+</title>
<style>
  :root{ --radius:16px; --shadow:0 10px 30px rgba(0,0,0,.15); --speed:300ms; }
  *{box-sizing:border-box}
  body{ margin:0; min-height:100vh; display:flex; align-items:center; justify-content:center;
    font-family:Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    background: linear-gradient(135deg, #8EC5FC 0%, #E0C3FC 100%);}
  .wrap{ width:min(820px,94vw); background:#453C3C	; border-radius:24px; box-shadow:var(--shadow); padding:28px; }

  .top{ display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:12px; flex-wrap:wrap; }
  .badge{ background:#eef3ff; color:#2a4bd6; font-weight:700; padding:8px 12px; border-radius:999px; font-size:14px; }
  #scoreBadge{ background:#eafaf0; color:#1f7a3a; }

  .timerRow{ display:flex; align-items:center; gap:10px; margin:8px 0 20px }
  #timerText{ font-weight:700 }
  .bar{ flex:1; height:10px; background:#eee; border-radius:999px; overflow:hidden; box-shadow: inset 0 0 0 1px rgba(0,0,0,.04); }
  .fill{ height:100%; width:100%; background:#ffb703; transition:width linear; }

  .card{ background:#FFF0C4; padding:24px; border-radius:var(--radius); text-align:center; font-weight:800; font-size:22px; min-height:92px;
    display:flex; align-items:center; justify-content:center; box-shadow: inset 0 0 0 1px rgba(0,0,0,.05); }
  .fade-in{ animation:fadeIn .28s ease both } .fade-out{ animation:fadeOut .22s ease both }
  @keyframes fadeIn{ from{opacity:0; transform:translateY(6px)} to{opacity:1; transform:none} }
  @keyframes fadeOut{ from{opacity:1} to{opacity:0; transform:translateY(-6px)} }

  .answers{ margin-top:16px; display:grid; grid-template-columns:1fr; gap:12px }
  @media (min-width:640px){ .answers{ grid-template-columns:1fr 1fr } }
  .btn{ border:none; border-radius:14px; padding:16px; font-size:18px; font-weight:700; color:#fff; cursor:pointer; transition:transform var(--speed), filter var(--speed), box-shadow var(--speed); box-shadow:0 6px 18px rgba(0,0,0,.08); }
  .btn:hover{ transform:translateY(-2px) scale(1.02); filter:brightness(1.07) }
  .btn:disabled{ opacity:.85; cursor:default; transform:none; filter:none }

  .correct{ background:#18fdb8 !important; color:#fff !important; }
  .wrong{ background:#e65c39
 !important; color:#fff !important; animation:shake .22s linear 2 }
  @keyframes shake{ 0%,100%{transform:translateX(0)} 25%{transform:translateX(-6px)} 75%{transform:translateX(6px)} }
  .flash{ animation:flash 480ms ease both }
  @keyframes flash{ 0%{ box-shadow:0 0 0 0 rgba(40,167,69,.6) } 100%{ box-shadow:0 0 0 16px rgba(40,167,69,0) } }

  #board{ display:none; text-align:center; margin-top:10px;  color: white; }
  #board h2{ margin:8px 0 14px }
  .line{ opacity:0; transform:translateY(8px); transition:opacity .7s, transform .7s; font-size:18px; }
  .reveal{ opacity:1; transform:none }
  .actions{ margin-top:16px; display:flex; justify-content:center; gap:10px; flex-wrap:wrap }
  .ghost{ background:#2A1E29; color:#fff; border:none; border-radius:12px; padding:10px 16px; font-weight:800; cursor:pointer; transition:transform var(--speed), filter var(--speed); box-shadow:var(--shadow) }
  .ghost:hover{ transform:translateY(-1px) }

 .c1 { background: #b84f3e; } /* Muted Red-Orange from the ground/lava */
.c2 { background: #4e7a8e; } /* Desaturated Blue from the sky */
.c3 { background: #9c8a40; } /* Earthy Yellow-Green from the ground patterns */
.c4 { background: #5f3e5e; } /* Deep Muted Purple from the shadows */

  /* small stats row */
  .stats{ display:flex; gap:12px; flex-wrap:wrap; align-items:center; }
  .stat{ background:#f3f6ff; padding:8px 12px; border-radius:10px; font-weight:700; color:#213; }
  body {
  background-image: url('assets/Class.webp');
  background-size: cover;       /* fills the screen */
  background-position: center;  /* centers it */
  background-repeat: no-repeat; /* no tiling */
}



header {
  position: fixed;
  top: 0; left: 0;
  width: 100%;
  background: linear-gradient(90deg, #ff5f6d, #ffc371);
  color: white;
  padding: 15px 25px;
  display: flex;
  justify-content: space-between; /* title left, right container right */
  align-items: center;
  font-size: 1.8em;
  font-weight: bold;
  box-shadow: 0 4px 10px rgba(0,0,0,0.25);
  z-index: 9999;
}

.header-title {
  text-shadow: 1px 1px 2px rgba(0,0,0,0.4);
}

/* container for Menu + Fumo */
.header-right {
  display: flex;
  align-items: center;
  gap: 50px; /* space between Menu and Fumo */
}

/* Menu styling */
.menu-link {
  color: white;
  text-decoration: none;
  font-size: 0.9em;
  background: rgba(255,255,255,0.1);
  padding: 6px 12px;
  border-radius: 12px;
  transition: background 0.25s, transform 0.25s;
}

.menu-link:hover {
  background: rgba(255,255,255,0.25);
  transform: scale(1.05);
}

/* Fumo icon styling */
#fumoIcon {
    width: 48px;  /* bigger */
  height: 48px; /* bigger */
  cursor: pointer;
  transition: transform 0.15s;
}

/* squish effect on click */
#fumoIcon:active {
  transform: scaleX(1.3) scaleY(0.7);
}

/* push page content below header */
body {
  margin-top: 70px;
}


header {
  /* existing stylesâ€¦ */
  box-shadow: 0 4px 8px rgba(0,0,0,0.25); /* current shadow */
}

header {
    position: fixed;
    top: 0; left: 0;
    width: 100%;
    height: var(--header-height); /* Explicit height */
    background: linear-gradient(90deg, #ff5f6d, #ffc371);
    color: white;
    padding: 15px 25px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 1.8em;
    font-weight: bold;
    box-shadow: 0 4px 8px rgba(0,0,0,0.25);
    z-index: 9999;
}
</style>



<header>
  <div class="header-title"></div>
  
  <div class="header-right">
    <a href="index.html" class="menu-link">Menu</a>

  </div>
</header>

</head>
<body>
  <div class="wrap" id="app">
    <div class="top">
      <div class="badge" id="qBadge">Question 1/1</div>
      <div class="stats">
        <div class="badge" id="scoreBadge">Score: <span id="score">0</span></div>
        <div class="stat">Correct: <span id="correctCount">0</span></div>
        <div class="stat">Wrong: <span id="wrongCount">0</span></div>
        <div class="stat">Time: <span id="elapsed">00:00</span></div>
      </div>
    </div>

    <div class="card fade-in" id="question">Loadingâ€¦</div>

    <div class="answers" id="answers"></div>

    <div id="board">
      <h2>ðŸŽ‰ Final Score</h2>
      <div class="line" id="Lscore">Score: 0</div>
      <div class="line" id="Lcorrect">Correct: 0</div>
      <div class="line" id="Lwrong">Wrong: 0</div>
      <div class="line" id="Ltime">Total time: 00:00</div>
      <div class="line" id="Lavg">Avg / Q: 00:00</div>

      <div class="actions">
        <button class="ghost" id="retryShuffle">Retry (reshuffle)</button>
        <button class="ghost" id="retrySame">Retry (same order)</button>
      </div>
    </div>
  </div>

  <!-- audio hooks (point to your folder) -->
  <audio id="sClick" src="assets/sounds/sfx_click.ogg" preload="auto"></audio>
  <audio id="sCorrect" src="assets/sounds/Correct-1.ogg" preload="auto"></audio>
  <audio id="sWrong" src="assets/sounds/Incorrect-1.ogg" preload="auto"></audio>

<script>
/* ---------------- DATA ---------------- */
const QUESTIONS = [
   // PhÆ°Æ¡ng thá»©c biá»ƒu Ä‘áº¡t
  { q: "VÄƒn báº£n ká»ƒ láº¡i chuá»—i sá»± kiá»‡n, nhÃ¢n váº­t cÃ³ tÃ¬nh huá»‘ng rÃµ rÃ ng. PhÆ°Æ¡ng thá»©c biá»ƒu Ä‘áº¡t chá»§ yáº¿u lÃ :", opts:["MiÃªu táº£","Tá»± sá»±","Biá»ƒu cáº£m","Thuyáº¿t minh"], correct:"Tá»± sá»±" },
  { q: "Äoáº¡n vÄƒn bÃ y tá» cáº£m xÃºc, tÃ¢m tráº¡ng cá»§a tÃ¡c giáº£. PhÆ°Æ¡ng thá»©c biá»ƒu Ä‘áº¡t chÃ­nh lÃ :", opts:["Nghá»‹ luáº­n","Thuyáº¿t minh","Biá»ƒu cáº£m","Tá»± sá»±"], correct:"Biá»ƒu cáº£m" },
  { q: "VÄƒn báº£n cung cáº¥p kiáº¿n thá»©c vá» hiá»‡n tÆ°á»£ng thiÃªn nhiÃªn, giáº£i thÃ­ch nguyÃªn nhÃ¢n, cÃ¡ch thá»©c. PhÆ°Æ¡ng thá»©c biá»ƒu Ä‘áº¡t:", opts:["Tá»± sá»±","Thuyáº¿t minh","Biá»ƒu cáº£m","MiÃªu táº£"], correct:"Thuyáº¿t minh" },
  { q: "Äoáº¡n vÄƒn trÃ¬nh bÃ y quan Ä‘iá»ƒm, phÃ¢n tÃ­ch váº¥n Ä‘á» xÃ£ há»™i, nháº±m thuyáº¿t phá»¥c ngÆ°á»i Ä‘á»c. PhÆ°Æ¡ng thá»©c biá»ƒu Ä‘áº¡t:", opts:["Nghá»‹ luáº­n","MiÃªu táº£","Tá»± sá»±","Biá»ƒu cáº£m"], correct:"Nghá»‹ luáº­n" },
  { q: "Äoáº¡n vÄƒn miÃªu táº£ cáº£nh sÃ´ng nÃºi vá»›i chi tiáº¿t sinh Ä‘á»™ng, hÃ¬nh áº£nh trá»±c quan. PhÆ°Æ¡ng thá»©c biá»ƒu Ä‘áº¡t:", opts:["Tá»± sá»±","Biá»ƒu cáº£m","MiÃªu táº£","Thuyáº¿t minh"], correct:"MiÃªu táº£" },
  { q: "VÄƒn báº£n ká»ƒ chuyá»‡n káº¿t há»£p miÃªu táº£ chi tiáº¿t nhÃ¢n váº­t vÃ  cáº£nh váº­t, phÆ°Æ¡ng thá»©c chá»§ Ä‘áº¡o lÃ :", opts:["Biá»ƒu cáº£m","Tá»± sá»±","MiÃªu táº£","Thuyáº¿t minh"], correct:"Tá»± sá»±" },
  { q: "Äoáº¡n vÄƒn thá»ƒ hiá»‡n thÃ¡i Ä‘á»™, cáº£m xÃºc cá»§a tÃ¡c giáº£ trÆ°á»›c sá»± viá»‡c. PhÆ°Æ¡ng thá»©c biá»ƒu Ä‘áº¡t lÃ :", opts:["Biá»ƒu cáº£m","Thuyáº¿t minh","Nghá»‹ luáº­n","Tá»± sá»±"], correct:"Biá»ƒu cáº£m" },
  { q: "VÄƒn báº£n giáº£i thÃ­ch vá» tÃ¡c dá»¥ng cá»§a Ã¡nh sÃ¡ng máº·t trá»i Ä‘á»‘i vá»›i cÃ¢y cá»‘i. PhÆ°Æ¡ng thá»©c biá»ƒu Ä‘áº¡t:", opts:["Tá»± sá»±","Thuyáº¿t minh","Biá»ƒu cáº£m","MiÃªu táº£"], correct:"Thuyáº¿t minh" },
  { q: "VÄƒn báº£n phÃ¢n tÃ­ch, Ä‘Æ°a láº­p luáº­n Ä‘á»ƒ thuyáº¿t phá»¥c Ä‘á»™c giáº£ vá» má»™t quan Ä‘iá»ƒm xÃ£ há»™i. PhÆ°Æ¡ng thá»©c biá»ƒu Ä‘áº¡t:", opts:["Biá»ƒu cáº£m","MiÃªu táº£","Nghá»‹ luáº­n","Tá»± sá»±"], correct:"Nghá»‹ luáº­n" },

  // Biá»‡n phÃ¡p tu tá»«
  { q: "â€œDÃ²ng sÃ´ng láº¥p lÃ¡nh nhÆ° thá»§y tinhâ€ â†’ biá»‡n phÃ¡p:", opts:["áº¨n dá»¥","NhÃ¢n hÃ³a","So sÃ¡nh","HoÃ¡n dá»¥"], correct:"So sÃ¡nh" },
  { q: "â€œGiÃ³ hÃ¡t, lÃ¡ reo, trá»i mÃ¢y cÅ©ng cÆ°á»iâ€ â†’ biá»‡n phÃ¡p:", opts:["NhÃ¢n hÃ³a","NÃ³i quÃ¡","Äiá»‡p ngá»¯","ChÆ¡i chá»¯"], correct:"NhÃ¢n hÃ³a" },
  { q: "â€œVá»«a cháº¡y vá»«a hÃ©t, vá»«a khÃ³c vá»«a cÆ°á»iâ€ â†’ biá»‡n phÃ¡p:", opts:["Liá»‡t kÃª","NÃ³i giáº£m nÃ³i trÃ¡nh","CÃ¢u há»i tu tá»«","Äáº£o ngá»¯"], correct:"Liá»‡t kÃª" },
  { q: "â€œÃo dÃ i thÆ°á»›t tha, tÃ³c mÃ¢y bay bay, ná»¥ cÆ°á»i nhÆ° hoaâ€ â†’ biá»‡n phÃ¡p:", opts:["So sÃ¡nh","Liá»‡t kÃª","NÃ³i quÃ¡","ChÆ¡i chá»¯"], correct:"Liá»‡t kÃª" },
  { q: "â€œThá»i gian trÃ´i nhanh, cháº³ng chá» ai cáº£â€ â†’ biá»‡n phÃ¡p:", opts:["NhÃ¢n hÃ³a","Äáº£o ngá»¯","HoÃ¡n dá»¥","CÃ¢u há»i tu tá»«"], correct:"NhÃ¢n hÃ³a" },
  { q: "â€œAnh cÃ³ thá»ƒ lÃ m gÃ¬ khÃ¡c ngoÃ i viá»‡c má»‰m cÆ°á»i?â€ â†’ biá»‡n phÃ¡p:", opts:["CÃ¢u há»i tu tá»«","Liá»‡t kÃª","NÃ³i giáº£m nÃ³i trÃ¡nh","Äáº£o ngá»¯"], correct:"CÃ¢u há»i tu tá»«" },
  { q: "â€œTrÃ¡i tim rá»±c chÃ¡y, Ä‘Ã´i máº¯t láº¥p lÃ¡nh, giá»ng nÃ³i áº¥m Ã¡pâ€ â†’ biá»‡n phÃ¡p:", opts:["Liá»‡t kÃª","NhÃ¢n hÃ³a","NÃ³i quÃ¡","ChÆ¡i chá»¯"], correct:"Liá»‡t kÃª" },
  { q: "â€œKhÃ´ng pháº£i cÃ¡i Ä‘áº¹p, mÃ  lÃ  cÃ¡i diá»…m lá»‡â€ â†’ biá»‡n phÃ¡p:", opts:["PhÃ©p Ä‘á»‘i","NhÃ¢n hÃ³a","Äiá»‡p ngá»¯","HoÃ¡n dá»¥"], correct:"PhÃ©p Ä‘á»‘i" },
  { q: "â€œMÃ¢y trá»i trÃ´i, mÃ¢y trá»i láº¡i bayâ€ â†’ biá»‡n phÃ¡p:", opts:["Äiá»‡p cáº¥u trÃºc cÃ¢u","Liá»‡t kÃª","Äáº£o ngá»¯","CÃ¢u há»i tu tá»«"], correct:"Äiá»‡p cáº¥u trÃºc cÃ¢u" },
  { q: "â€œTa Ä‘Ã¢y lÃ  ai, sao láº¡i láº¡c vÃ o Ä‘Ã¢y?â€ â†’ biá»‡n phÃ¡p:", opts:["CÃ¢u há»i tu tá»«","NhÃ¢n hÃ³a","Liá»‡t kÃª","PhÃ©p Ä‘á»‘i"], correct:"CÃ¢u há»i tu tá»«" },

  // Thá»ƒ thÆ¡
  { q: "8 cÃ¢u, má»—i cÃ¢u 7 chá»¯, tuÃ¢n luáº­t báº±ng tráº¯c, váº§n theo quy táº¯c â†’ thá»ƒ thÆ¡:", opts:["Lá»¥c bÃ¡t","Tháº¥t ngÃ´n bÃ¡t cÃº","Tháº¥t ngÃ´n tá»© tuyá»‡t","Song tháº¥t lá»¥c bÃ¡t"], correct:"Tháº¥t ngÃ´n bÃ¡t cÃº" },
  { q: "4 cÃ¢u, má»—i cÃ¢u 7 chá»¯, váº§n cÃ¢u 1,2,4 â†’ thá»ƒ:", opts:["Tháº¥t ngÃ´n tá»© tuyá»‡t","Tháº¥t ngÃ´n bÃ¡t cÃº","Lá»¥c bÃ¡t","ThÆ¡ nÄƒm chá»¯"], correct:"Tháº¥t ngÃ´n tá»© tuyá»‡t" },
  { q: "2 cÃ¢u tháº¥t + 1 cÃ¢u lá»¥c + 1 cÃ¢u bÃ¡t â†’ thá»ƒ:", opts:["Tháº¥t ngÃ´n bÃ¡t cÃº","Lá»¥c bÃ¡t","Song tháº¥t lá»¥c bÃ¡t","ThÆ¡ bá»‘n chá»¯"], correct:"Song tháº¥t lá»¥c bÃ¡t" },
  { q: "Má»—i cÃ¢u 6 chá»¯, ngáº¯t nhá»‹p 2/2/2 â†’ thá»ƒ:", opts:["ThÆ¡ sÃ¡u chá»¯","ThÆ¡ nÄƒm chá»¯","Lá»¥c bÃ¡t","Tháº¥t ngÃ´n tá»© tuyá»‡t"], correct:"ThÆ¡ sÃ¡u chá»¯" },
  { q: "BÃ i thÆ¡ 5 chá»¯, váº§n linh hoáº¡t, gáº§n gÅ©i â†’ thá»ƒ:", opts:["ThÆ¡ bá»‘n chá»¯","ThÆ¡ nÄƒm chá»¯","ThÆ¡ sÃ¡u chá»¯","Lá»¥c bÃ¡t"], correct:"ThÆ¡ nÄƒm chá»¯" },
  { q: "4 chá»¯, nhá»‹p ngáº¯n, thÆ°á»ng dÃ¹ng dÃ¢n ca â†’ thá»ƒ:", opts:["ThÆ¡ bá»‘n chá»¯","ThÆ¡ nÄƒm chá»¯","ThÆ¡ sÃ¡u chá»¯","Lá»¥c bÃ¡t"], correct:"ThÆ¡ bá»‘n chá»¯" },
  { q: "Thá»ƒ thÆ¡ Ä‘áº·c trÆ°ng Viá»‡t Nam, cÃ¢u 6 ná»‘i cÃ¢u 8 â†’ thá»ƒ:", opts:["Lá»¥c bÃ¡t","Tháº¥t ngÃ´n bÃ¡t cÃº","Song tháº¥t lá»¥c bÃ¡t","Tháº¥t ngÃ´n tá»© tuyá»‡t"], correct:"Lá»¥c bÃ¡t" },
  { q: "ThÆ¡ ÄÆ°á»ng luáº­t, 8 cÃ¢u, 7 chá»¯ má»—i cÃ¢u, luáº­t báº±ng tráº¯c cháº·t cháº½ â†’ thá»ƒ:", opts:["Tháº¥t ngÃ´n bÃ¡t cÃº","Lá»¥c bÃ¡t","Song tháº¥t lá»¥c bÃ¡t","Tháº¥t ngÃ´n tá»© tuyá»‡t"], correct:"Tháº¥t ngÃ´n bÃ¡t cÃº" },

  // NgÃ´i ká»ƒ
  { q: "CÃ¢u chuyá»‡n ká»ƒ tá»« â€œtÃ´iâ€, nhÃ¢n váº­t chÃ­nh lÃ  ngÆ°á»i ká»ƒ â†’ ngÃ´i ká»ƒ:", opts:["NgÃ´i thá»© nháº¥t","NgÃ´i thá»© hai","NgÃ´i thá»© ba","NgÃ´i khÃ¡ch quan"], correct:"NgÃ´i thá»© nháº¥t" },
  { q: "â€œAnh áº¥yâ€ ká»ƒ, ngÆ°á»i ká»ƒ Ä‘á»©ng ngoÃ i â†’ ngÃ´i ká»ƒ:", opts:["NgÃ´i thá»© nháº¥t","NgÃ´i thá»© hai","NgÃ´i thá»© ba","NgÃ´i trá»±c tiáº¿p"], correct:"NgÃ´i thá»© ba" },
  { q: "NgÆ°á»i ká»ƒ trá»±c tiáº¿p Ä‘á»‘i thoáº¡i vá»›i ngÆ°á»i Ä‘á»c â†’ ngÃ´i ká»ƒ:", opts:["NgÃ´i thá»© nháº¥t","NgÃ´i thá»© hai","NgÃ´i thá»© ba","NgÃ´i khÃ¡ch quan"], correct:"NgÃ´i thá»© hai" },
  { q: "CÃ¢u chuyá»‡n ká»ƒ tá»« ngÆ°á»i ngoÃ i, quan sÃ¡t táº¥t cáº£ nhÃ¢n váº­t â†’ ngÃ´i ká»ƒ:", opts:["NgÃ´i thá»© nháº¥t","NgÃ´i thá»© hai","NgÃ´i thá»© ba","NgÃ´i trá»±c tiáº¿p"], correct:"NgÃ´i thá»© ba" },
  { q: "NhÃ¢n váº­t ká»ƒ vá» chÃ­nh mÃ¬nh â†’ ngÃ´i ká»ƒ:", opts:["NgÃ´i thá»© nháº¥t","NgÃ´i thá»© hai","NgÃ´i thá»© ba","NgÃ´i khÃ¡ch quan"], correct:"NgÃ´i thá»© nháº¥t" },
  { q: "NgÆ°á»i ká»ƒ trá»±c tiáº¿p nháº¯c Ä‘áº¿n â€œbáº¡nâ€, â€œcÃ¡c báº¡nâ€ â†’ ngÃ´i ká»ƒ:", opts:["NgÃ´i thá»© nháº¥t","NgÃ´i thá»© hai","NgÃ´i thá»© ba","NgÃ´i trá»±c tiáº¿p"], correct:"NgÃ´i thá»© hai" },
  { q: "TÃ¡c giáº£ ká»ƒ tá»« gÃ³c nhÃ¬n toÃ n tri â†’ ngÃ´i ká»ƒ:", opts:["NgÃ´i thá»© nháº¥t","NgÃ´i thá»© hai","NgÃ´i thá»© ba","NgÃ´i trá»±c tiáº¿p"], correct:"NgÃ´i thá»© ba" },
  { q: "NgÆ°á»i ká»ƒ khÃ´ng tham gia cÃ¢u chuyá»‡n, quan sÃ¡t khÃ¡ch quan â†’ ngÃ´i ká»ƒ:", opts:["NgÃ´i thá»© nháº¥t","NgÃ´i thá»© hai","NgÃ´i thá»© ba","NgÃ´i khÃ¡ch quan"], correct:"NgÃ´i thá»© ba" }
];

/* ---------------- STATE ---------------- */
let order = [];
let qi = 0;
let score = 0;
let correctCount = 0;
let wrongCount = 0;
let startTime = null;
let questionStart = null;
let elapsedInterval = null;
let lastOrderSaved = []; // for "same order" retry

/* ---------------- DOM ---------------- */
const qBadge = document.getElementById('qBadge');
const scoreBadge = document.getElementById('score');
const correctBadge = document.getElementById('correctCount');
const wrongBadge = document.getElementById('wrongCount');
const questionEl = document.getElementById('question');
const answersEl = document.getElementById('answers');
const elapsedEl = document.getElementById('elapsed');
const board = document.getElementById('board');
const Lscore = document.getElementById('Lscore');
const Lcorrect = document.getElementById('Lcorrect');
const Lwrong = document.getElementById('Lwrong');
const Ltime = document.getElementById('Ltime');
const Lavg = document.getElementById('Lavg');
const retryShuffle = document.getElementById('retryShuffle');
const retrySame = document.getElementById('retrySame');

const sClick = document.getElementById('sClick');
const sCorrect = document.getElementById('sCorrect');
const sWrong = document.getElementById('sWrong');

/* ---------------- UTIL ---------------- */
function shuffle(arr){
  for(let i=arr.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]]=[arr[j],arr[i]];
  }
  return arr;
}
function formatTime(ms){
  const s = Math.floor(ms/1000);
  const mm = String(Math.floor(s/60)).padStart(2,'0');
  const ss = String(s%60).padStart(2,'0');
  return `${mm}:${ss}`;
}

/* ---------------- QUIZ FLOW ---------------- */
function start(reshuffle=true, preserveOrder=false){
  // reset stats
  score = 0; correctCount = 0; wrongCount = 0;
  qi = 0;

  // create order
  order = Array.from({length: QUESTIONS.length}, (_,i)=>i);
  if(reshuffle) shuffle(order);
  if(preserveOrder && lastOrderSaved.length===order.length) order = [...lastOrderSaved];
  lastOrderSaved = [...order];

  // timer
  startTime = Date.now();
  questionStart = Date.now();
  if(elapsedInterval) clearInterval(elapsedInterval);
  elapsedInterval = setInterval(()=> {
    elapsedEl.textContent = formatTime(Date.now()-startTime);
  }, 250);

  // UI
  board.style.display = 'none';
  questionEl.style.display = 'flex';
  answersEl.style.display = 'grid';
  updateBadges();
  renderQuestion();
}

function renderQuestion(){
  if(qi >= order.length){ return finish(); }

  // animate swap
  questionEl.classList.remove('fade-in'); questionEl.classList.add('fade-out');
  setTimeout(()=>{
    const q = QUESTIONS[order[qi]];
    questionEl.textContent = q.q;
    questionEl.classList.remove('fade-out'); questionEl.classList.add('fade-in');

    qBadge.textContent = `Question ${qi+1}/${order.length}`;

    answersEl.innerHTML = '';
    const opts = shuffle([...q.opts]); // randomize answer order
    const colorClasses = shuffle(['c1','c2','c3','c4']);
    opts.forEach((opt, idx)=>{
      const btn = document.createElement('button');
      btn.className = `btn ${colorClasses[idx]}`;
      btn.textContent = opt;
      btn.dataset.correct = (opt === q.correct) ? '1':'0';
      // play click sound on mousedown for snappy feel, but still evaluate on click
      btn.addEventListener('mousedown', ()=> { try { sClick.currentTime=0; sClick.play(); } catch(e){} });
      btn.addEventListener('click', ()=> choose(btn));
      answersEl.appendChild(btn);
    });

    // mark question start time
    questionStart = Date.now();
  }, 180);
}

function lockAnswers(){
  document.querySelectorAll('.btn').forEach(b=> b.disabled = true);
}

function choose(btn){
  if(btn.disabled) return;
  lockAnswers();

  const isCorrect = btn.dataset.correct === '1';

  // compute time per question if needed later
  const qTime = Date.now() - questionStart;

  if(isCorrect){
    btn.classList.add('correct','flash');
    score += 1;
    correctCount += 1;
    try { sCorrect.currentTime = 0; sCorrect.play(); } catch(e){}
    // highlight only chosen correct (no other wrong highlight needed)
    document.querySelectorAll('.btn').forEach(b => {
      if(b.dataset.correct === '1') b.classList.add('correct');
      b.disabled = true;
    });
  } else {
    wrongCount += 1;
    try { sWrong.currentTime = 0; sWrong.play(); } catch(e){}
    // mark ALL wrong answers red and the correct one green
    document.querySelectorAll('.btn').forEach(b=>{
      if(b.dataset.correct === '1'){
        b.classList.add('correct');
      }else{
        b.classList.add('wrong');
      }
      b.disabled = true;
    });
    // also add small red effect to the clicked button (it already gets wrong class)
  }

  updateBadges();
  // next question after a pause so user sees feedback
  setTimeout(()=> {
    qi++;
    renderQuestion();
  }, 950);
}

function finish(){
  clearInterval(elapsedInterval);
  const totalMs = Date.now() - startTime;
  questionEl.style.display = 'none';
  answersEl.style.display = 'none';
  board.style.display = 'block';

  // fill final stats
  Lscore.textContent = `Score: ${score} / ${QUESTIONS.length}`;
  Lcorrect.textContent = `Correct: ${correctCount}`;
  Lwrong.textContent = `Wrong: ${wrongCount}`;
  Ltime.textContent = `Total time: ${formatTime(totalMs)}`;
  const avgMs = totalMs / QUESTIONS.length;
  Lavg.textContent = `Avg / Q: ${formatTime(Math.round(avgMs))}`;

  // reveal animations (stagger)
  [Lscore,Lcorrect,Lwrong,Ltime,Lavg].forEach((el, i) => {
    setTimeout(()=> el.classList.add('reveal'), 80 * (i+1));
  });
  // show retry buttons enabled
  retryShuffle.disabled = false;
  retrySame.disabled = false;
}

function updateBadges(){
  document.getElementById('score').textContent = score;
  correctBadge.textContent = correctCount;
  wrongBadge.textContent = wrongCount;
}

/* ---------------- RESTART BUTTON HOOKS ---------------- */
retryShuffle.addEventListener('click', ()=> {
  retryShuffle.disabled = true; retrySame.disabled = true;
  start(true, false);
});
retrySame.addEventListener('click', ()=> {
  retryShuffle.disabled = true; retrySame.disabled = true;
  start(false, true);
});

/* ---------------- BOOT ---------------- */
start(true);




</script>
</body>
</html>
